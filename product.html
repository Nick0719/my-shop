<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å•†å“è©³æƒ… - æˆ‘çš„è³¼ç‰©å•†åŸ</title>
    <style>
        /* --- 1. åŸºç¤ä½ˆå±€ --- */
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background: #f4f4f4; margin: 0; padding-top: 50px; display: flex; justify-content: center; }
        .product-container { width: 95%; max-width: 1200px; display: flex; flex-direction: column; align-items: center; }
        
        .product-box { display: flex; gap: 50px; background: white; padding: 40px; border-radius: 12px; width: 100%; box-shadow: 0 4px 15px rgba(0,0,0,0.1); box-sizing: border-box; }
        .img-side { flex: 1; height: 500px; background: #eee; border-radius: 10px; overflow: hidden; }
        .img-side img { width: 100%; height: 100%; object-fit: cover; }
        
        .info-side { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .price { color: #d9534f; font-size: 45px; font-weight: bold; margin: 20px 0; }
        .desc-box { line-height: 1.8; color: #555; background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        
        .add-btn { background: #28a745; color: white; border: none; padding: 18px; cursor: pointer; font-size: 22px; border-radius: 8px; transition: 0.3s; font-weight: bold; }
        .add-btn:hover { background: #218838; transform: translateY(-3px); }

        /* --- 2. å´é‚Šè³¼ç‰©è»Šé¢æ¿ (ä¿®æ­£ï¼šè£œå›ä¸è¦‹çš„éƒ¨åˆ†) --- */
        .sidebar { position: fixed; top: 0; right: -320px; width: 320px; height: 100%; background: #222; color: #eee; padding: 25px; transition: 0.4s ease; z-index: 2000; box-shadow: -5px 0 20px rgba(0,0,0,0.5); box-sizing: border-box; }
        .sidebar.active { right: 0; }
        .toggle-btn { position: fixed; top: 50%; right: 0; transform: translateY(-50%); z-index: 2001; padding: 15px 20px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 10px 0 0 10px; font-size: 24px; }
        .sidebar-header { font-size: 22px; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        .sidebar-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 14px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .sidebar-total { font-size: 24px; font-weight: bold; margin-top: 25px; padding-top: 15px; border-top: 2px solid #444; color: #fff; display: flex; justify-content: space-between; }
        .checkout-link { display: block; width: 100%; padding: 15px; background: #28a745; color: white; text-align: center; text-decoration: none; border-radius: 6px; font-weight: bold; margin-top: 25px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="product-container">
        <div class="product-box">
            <div class="img-side"><img id="pImg" src="" alt="å•†å“åœ–ç‰‡"></div>
            <div class="info-side">
                <h1 id="pName" style="margin:0;">è¼‰å…¥ä¸­...</h1>
                <div class="price" id="pPrice">$ 0</div>
                <div class="desc-box" id="pDesc">æ­£åœ¨è®€å–å•†å“è³‡è¨Š...</div>
                
                <div style="margin-bottom: 20px; font-size: 18px;">
                    æ•¸é‡ï¼š<input type="number" id="qtyInput" value="1" min="1" style="width: 60px; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
                </div>
                
                <button class="add-btn" onclick="addToCart()">ğŸ›’ åŠ å…¥è³¼ç‰©è»Š</button>
                <a href="1203.html" style="margin-top:25px; display:inline-block; color:#007bff; text-decoration:none; font-weight:bold;">â† è¿”å›é¦–é ç¹¼çºŒé€›</a>
            </div>
        </div>
    </div>

    <button class="toggle-btn" onclick="toggleSidebar()">ğŸ›’</button>
    <aside class="sidebar" id="mainSidebar">
        <div class="sidebar-header">
            <span>æˆ‘çš„è³¼ç‰©æ¸…å–®</span>
            <span onclick="toggleSidebar()" style="cursor:pointer;">&times;</span>
        </div>
        <div id="sidebarContent"></div>
        <div class="sidebar-total">
            <span>ç¸½è¨ˆ:</span>
            <span id="sidebarTotalText">$ 0</span>
        </div>
        <a href="cart.html" class="checkout-link">å‰å¾€çµå¸³é é¢</a>
    </aside>

    <script src="products.js"></script>
    <script>
        // 1. åˆå§‹åŒ–å•†å“è³‡æ–™
        const pid = new URLSearchParams(window.location.search).get('id');
        const product = allProducts.find(p => p.id === pid);

        if(product) {
            document.getElementById('pName').innerText = product.name;
            document.getElementById('pPrice').innerText = `$ ${product.price.toLocaleString()}`;
            document.getElementById('pDesc').innerText = product.desc;
            document.getElementById('pImg').src = product.image;
        }

        // 2. å´é‚Šæ¬„æ§åˆ¶
        function toggleSidebar() { 
            document.getElementById('mainSidebar').classList.toggle('active'); 
        }

        // 3. åŠ å…¥è³¼ç‰©è»Šé‚è¼¯ (ç¢ºä¿åŒ…å«åœ–ç‰‡)
        function addToCart() {
            if(!product) return;
            const qty = parseInt(document.getElementById('qtyInput').value) || 1;
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const exist = cart.find(i => i.id === product.id);
            
            if(exist) {
                exist.qty += qty;
            } else {
                // ã€é—œéµã€‘ç¢ºä¿å­˜å…¥ image ç¶²å€ï¼Œçµå¸³é æ‰æŠ“å¾—åˆ°åœ–
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    qty: qty
                });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // åŠ å…¥å¾Œå‹•ä½œï¼šæ›´æ–°å´é‚Šæ¬„ä¸¦è‡ªå‹•æ‰“é–‹å®ƒ
            refreshSidebar();
            document.getElementById('mainSidebar').classList.add('active');
        }

        // 4. æ›´æ–°å´é‚Šæ¬„å…§å®¹
        function refreshSidebar() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('sidebarContent');
            const totalText = document.getElementById('sidebarTotalText');
            let total = 0, html = '';
            
            cart.forEach(item => {
                const sub = item.price * item.qty;
                total += sub;
                html += `
                    <div class="sidebar-item">
                        <div>
                            <div style="font-weight:bold; color:#fff;">${item.name}</div>
                            <div style="color:#aaa; font-size:12px;">$ ${item.price.toLocaleString()} x ${item.qty}</div>
                        </div>
                        <div style="color:#28a745; font-weight:bold;">$ ${sub.toLocaleString()}</div>
                    </div>`;
            });
            container.innerHTML = html || '<p style="text-align:center; color:#888;">è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>';
            totalText.textContent = `$ ${total.toLocaleString()}`;
        }

        // ç›£è½è·¨é è®Šå‹•
        window.addEventListener('storage', (e) => {
            if (e.key === 'cart') refreshSidebar();
        });

        // åˆå§‹è®€å–
        window.onload = refreshSidebar;
    </script>
</body>
</html>