<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å•†å“åˆ†é¡åˆ—è¡¨ - è‡ªå‹•åŒ–ç‰ˆ</title>
    <style>
        /* --- å¦³åŸæœ¬çš„æ¨£å¼ (ä¿ç•™) --- */
        body { font-family: Arial; background: #f8f8f8; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px; }
        .product-item { border: 1px solid #eee; padding: 15px; text-align: center; border-radius: 5px; transition: 0.3s; }
        .product-item:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); transform: translateY(-5px); }
        /* ä¿®æ”¹åŸæœ¬çš„ placeholder-img æ¨£å¼ï¼Œä½¿å…¶æ”¯æ´é¡¯ç¤ºåœ–ç‰‡ */
        .placeholder-img { width: 100%; height: 150px; background: #eee; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; color: #999; overflow: hidden; }
        .placeholder-img img { width: 100%; height: 100%; object-fit: cover; }
        .price { color: #d9534f; font-weight: bold; }
        a { text-decoration: none; color: inherit; }

        /* --- ã€æ–°å¢ã€‘å´é‚Šè³¼ç‰©è»Šé¢æ¿æ¨£å¼ (ä¿æŒå…¨ç«™ä¸€è‡´) --- */
        .sidebar { position: fixed; top: 0; right: -320px; width: 320px; height: 100%; background: #222; color: #eee; padding: 25px; transition: 0.4s ease; z-index: 2000; box-shadow: -5px 0 20px rgba(0,0,0,0.5); box-sizing: border-box; }
        .sidebar.active { right: 0; }
        .toggle-btn { position: fixed; top: 50%; right: 0; transform: translateY(-50%); z-index: 2001; padding: 15px 20px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 10px 0 0 10px; font-size: 24px; }
        .sidebar-header { font-size: 22px; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        .sidebar-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 14px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .sidebar-total { font-size: 24px; font-weight: bold; margin-top: 25px; padding-top: 15px; border-top: 2px solid #444; color: #fff; display: flex; justify-content: space-between; }
        .checkout-link { display: block; width: 100%; padding: 15px; background: #28a745; color: white; text-align: center; text-decoration: none; border-radius: 6px; font-weight: bold; margin-top: 25px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="catName">è¼‰å…¥ä¸­...</h1>
        <div class="product-grid" id="productList"></div>
        <a href="1203.html" style="display:inline-block; margin-top: 20px; color: #666; text-decoration: none;">â† è¿”å›é¦–é </a>
    </div>

    <button class="toggle-btn" onclick="toggleSidebar()">ğŸ›’</button>
    <aside class="sidebar" id="mainSidebar">
        <div class="sidebar-header">
            <span>æˆ‘çš„è³¼ç‰©æ¸…å–®</span>
            <span onclick="toggleSidebar()" style="cursor:pointer;">&times;</span>
        </div>
        <div id="sidebarCartContent"></div>
        <div class="sidebar-total">
            <span>ç¸½è¨ˆ:</span>
            <span id="sidebarTotalText">$ 0</span>
        </div>
        <a href="cart.html" target="_blank" class="checkout-link">å‰å¾€çµå¸³åˆ†é </a>
    </aside>

    <script src="products.js"></script>
    <script>
        // --- 1. ã€æ–°å¢ã€‘å´é‚Šæ¬„é–‹é—œåŠŸèƒ½ ---
        function toggleSidebar() { 
            document.getElementById('mainSidebar').classList.toggle('active'); 
        }

        // --- 2. ã€æ–°å¢ã€‘åŒæ­¥å´é‚Šè³¼ç‰©è»Šæ¸…å–® ---
        function refreshSidebarCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('sidebarCartContent');
            const totalText = document.getElementById('sidebarTotalText');
            let total = 0, html = '';
            
            cart.forEach(item => {
                const sub = item.price * item.qty;
                total += sub;
                html += `
                    <div class="sidebar-item">
                        <div>
                            <div style="font-weight:bold; color:#fff;">${item.name}</div>
                            <div style="color:#aaa; font-size:12px;">$ ${item.price.toLocaleString()} x ${item.qty}</div>
                        </div>
                        <div style="color:#28a745; font-weight:bold;">$ ${sub.toLocaleString()}</div>
                    </div>`;
            });
            container.innerHTML = html || '<p style="text-align:center; color:#888;">è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>';
            totalText.textContent = `$ ${total.toLocaleString()}`;
        }

        // --- 3. å¦³åŸæœ¬çš„åˆ†é¡æ¸²æŸ“é‚è¼¯ (ä¿ç•™ä¸¦æ–°å¢åœ–ç‰‡æ”¯æ´) ---
        if (typeof allProducts === 'undefined') {
            document.body.innerHTML = "<h1>éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° products.js è³‡æ–™æª”æ¡ˆã€‚è«‹ç¢ºèªæª”æ¡ˆæ”¾åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ã€‚</h1>";
        } else {
            const params = new URLSearchParams(window.location.search);
            const cat = params.get('name') || "é›»å­ç”¢å“";
            document.getElementById('catName').innerText = cat + " - å•†å“åˆ—è¡¨";

            const grid = document.getElementById('productList');
            const filtered = allProducts.filter(p => p.category === cat);

            filtered.forEach(p => {
                const box = document.createElement('div');
                box.className = 'product-item';
                // é€™è£¡å°‡åŸæœ¬é¡¯ç¤ºåå­—çš„å€å¡Šæ”¹æˆé¡¯ç¤ºåœ–ç‰‡
                box.innerHTML = `
                    <a href="product.html?id=${p.id}">
                        <div class="placeholder-img">
                            <img src="${p.image}" alt="${p.name}">
                        </div>
                        <h3>${p.name}</h3>
                        <p class="price">$ ${p.price.toLocaleString()}</p>
                    </a>
                `;
                grid.appendChild(box);
            });
        }

        // --- 4. ã€æ–°å¢ã€‘ç›£è½è·¨åˆ†é è®Šå‹• ---
        window.addEventListener('storage', (e) => {
            if (e.key === 'cart') refreshSidebarCart();
        });

        // åˆå§‹åŒ–
        window.onload = refreshSidebarCart;
    </script>
</body>
</html>